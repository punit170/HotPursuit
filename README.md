# HotPursuit
An implementation of a variant of the Poiliceman/Thief graph game using Scala/Play Framework.

#### Myself: Punit Malpani
#### email: pmalpa2@uic.edu

# Project Title: HotPursuit (using Play 3)
# Project Description: 
This project aims to develop a restful service to enable clients to play a variant of the Policeman/Thief game by sending http request to the service. This project uses large graphs (resembling nodes in the game) generated by the NetGraphSim platform. This project uses graphs developed from the NetGraphSimulator project developed by Prof. Mark Grechanik [NetGameSim](https://github.com/0x1DOCD00D/NetGameSim).


## Tasks:
### 1. Implementation of confidence-score generation algorithm
A pair of graph is generated from NetGameSim- 1)Original Graph (referenced as originalNetGraph in code) 2)Perturbed Graph(referenced as perturbedNetGraph in code). 
As first step of this project, graphs are read in. To understand upto what degree the perturbed nodes match their counterpart original nodes, confidence scores are calculated for nodes in the perturbed graph. The algorithm takes in the two graphs, calculates confidence scores for each node in the perturbed graphs, and output a map with key: nodeId, value: conf score.

### 2. Construction of routes for http-requests
Routes are constructed that define requests to use this restful-service. This project uses the Play framework where routes are to be defined inside the **conf** directory inside a file named ***routes***. [Play FrameWork Anatomy](https://www.playframework.com/documentation/3.0.x/Anatomy)

### 3. Implementation of backend-logic
As the third step, logic functions are created that define the backend working of the game. Play follows the MVC architecture, and the logic functions are declared under models.

### 4. Contruction of controllers:
A Controller defines the behaviour of the service- what responses to be given against requests. These are defined under the controllers module of the application.

Note: Since this is a restful service and not a complete web-app, no webpage views have been created. 


# How to install and run the project
Requirements: [Java Development Toolkit (JDK)](https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html) and [Simple Build Toolkit (SBT)](https://www.scala-sbt.org/1.x/docs/index.html)

(This project uses case classes from [NetGameSim](https://github.com/0x1DOCD00D/NetGameSim) developed by Prof. Mark Grechanik. These case classes define the nodes and edges of the graphs. Assuming NetGraphSim is working on the system, this project takes 2 graphs files as input - 1) a .txt file, 2) .txt.perturbed file. **Note:NetGameSim produces ".ngs" and ".ngs.perturbed" files. Additional code (present in this repository's path: */app/assets/AddTo_NetGameSim/NGStoText.scala* should be added in the NetGameSim's *base directory/src/main/scala/* directory as per instruction in the comments of NGStoText.scala, in order to produce ".txt", and ".txt.perturbed" files that are text file representations of the same graphs.**

## Installations Used
+ Install Simple Build Toolkit (SBT)[MSI Installer](https://www.scala-sbt.org/1.x/docs/Installing-sbt-on-Windows.html). Ensure you can create, compile and run Java and Scala programs.
+ Development Environment: Windows 11
+ Oracle OpenJDK 17.0.8 (compatible with Play 3)
+ Scala 2.13.12
+ sbt version - 1.9.6 (in project>build.properties)
+ Other dependencies exist in build.sbt
+ IntelliJ IDEA Ultimate

# How to use the project
Clone the project from gihub. The base directory should be "HotPursuit"<br>

1. As first step, go to the application.conf file and set the configuration. This file contains all folder and file path settings required for this project.
All the configurations are set in the /conf/application.conf file. 

- **dir** - path to the directory where all the graph files (someOriginalGraph.txt, somePerturbedGraph.txt.perturbed) are stored <br>. For easiness, keep it as *./app/assets/* and store the graph files inside the assets directory.
- **originalGraph**- file name of the original graph (required .txt extension) <br>
- **perturbedGraph**- file name of the original graph (required .txt.perturbed extension) <br>
- **masterURL** = This decides the file system. This could be set either = "hdfs://localhost:*port*" or "local" or "s3://<*your_bucket_name*>" depending on the filesystem being used.

2. Save graphs files with .txt, .txt.perturbed in the *dir* folder.

4. From the terminal, navigate to base directory and run **sbt clean compile**. Then, run **sbt run**. No command line arguments are required.

## Working Explanation
(Italics are used to reference application.conf parameters)
### 1. HomeController.scala
This is the HomeController.scala file which contains all the controller functions. It basically defines the behaviour of the service- what responses to be given against requests. It calls logic functions from LogicHelperFunctions.scala (under the models section). Explanations for individual components are provided as comments inside HomeController.scala.

### 2. LogicHelperFunctions.scala
This file contains helper functions that contain logic implementions of all sorts including deserialization, confidence-score generation algorithm, game start, player selection, player moves etc. which are integral to this application. 

### 3. routes
Routes are constructed that define requests to use this restful-service. These are defined under **conf** directory inside a file named ***routes***. 

The game employs the following routes (used as part of URLs):
+ GET    /startGame                   - to start the game
+ GET    /game/instructions           - to see game instructions
+ GET    /stopGame                    - to stop the game at any point
+ PUT    /game/selectplayers          - to select actors for player 1 and player 2. This request should be made after the game has been started. The request should contain json data as {"player1":"policeman"(or "thief"), "player2":"thief"(or "policeman")} within its body.
+ PUT    /game/move/:playerNo/:nodeId - to move the player with playerid='playerNo' to node with node id=nodeId. This request should be made after the game has been started and players have been selected. e.g., PUT/ http://localhost:9000/move/1/10 => request to move player1 to node with nodeId=10
+ GET    /game/getStatusData          - to obtain information about a player's own and the opponent's location nodesIds and the adjacent nodesIds
+ GET    /auto                        - to invoke an automatic game play that simulates a random game till the end 

### 4. app> assets> AddTo_NetGameSim> NGStoText.scala
This file contains code that should be used with NetGameSim to generate text output files.


## FOR running in a local machine

Steps to run:
(Set paths under local scope in application.conf if the underlying graph of the game needs to be changed (see description at the top))
1. from the terminal navigate to the base directory run *sbt clean compile* then *sbt run*. This should start the server.
2. Now the game can be played through any utility like cURL or api like postman. 


## FOR deploying this service on Amazon EC2 and accessing it over the internet
Steps to run:
1. Select an EC2 instance with atleast 4GB RAM. Make sure it has a public ip address. Configure it by installing java jdk 17.0.8 and sbt 1.9.6/1.9.7. Also Download pacakages for unzip and git functionalities.  
2. Fetch this Also Download pacakages for unzip and git functionalities.  
3. Clone this git repository.
4. Navigate inside the cloned directory and run the command 'sbt clean compile' from the terminal to compile the service.
5. Run 'sbt run' command to start the service.
6. Create an inbound rule for the EC2 instance and make it available for your selected port(by default 9000) to listen to requests from over the internet.
7. Now thae game can be played by making requests from a local machine to the **ec2Instance-publicIP:9000**
   
# ERRORS 
(lossely handled)
Following Bad Requests (self-explanatory) messages will be responded for corresponding situations:
1. **"The game has not started, and so players cannot be set. To start the game make a GET / request to http://localhost:9000/startGame"** - If a select player request is made before starting a game.
    
2. **"Players already set! Cannot reset them, while the game is on!"** - If another select player request is made when the game is on and player have been already selected. 
  
3. **"PlayerNo should be either 1 or 2. You can replay the move by making another PUT / request to http://localhost:9000/game/:playerNo/:nodeId with valid parameters!"** - when an invalid player no is given inside the move player url

4. **"Player$playerNo cannot make two moves consecutively!** - when consecutive move requests are made for the same player 
    
5. **Invalid move!. Check nodeId / playerNo!** - when an invalid nodeId (or player no) is given inside the move player url
    

## Scope for improvement
1. Game can be integrated with the NetGameSim project for random graph generation every time the game starts.
2. Multiple 'policeman' and 'thief' players can be accomodated in one game.  
   
### YouTube link:
[YouTube Link- project demonstration + aws ec2 deployment](https://www.youtube.com/watch?v=vagaZzr5I2w)
